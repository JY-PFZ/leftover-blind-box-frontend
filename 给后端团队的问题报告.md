# Cart API 400é”™è¯¯ - éœ€è¦åç«¯ä¿®å¤

## é—®é¢˜æè¿°
å‰ç«¯è°ƒç”¨Cart APIæ·»åŠ å•†å“åˆ°è´­ç‰©è½¦æ—¶ï¼Œè¿”å›400 Bad Requesté”™è¯¯ã€‚

## é”™è¯¯ä¿¡æ¯
```
POST http://13.215.158.65:10016/api/cart/15/items?magicbagId=102&quantity=1
400 Bad Request

Response:
{
  "code": 0,
  "message": "FAIL: Error querying database. Cause: java.sql.SQLSyntaxErrorException: Unknown column 'magicbag_id' in 'where clause'",
  "data": null
}
```

## è¯¦ç»†é”™è¯¯æ—¥å¿—
```
SQL: SELECT cart_item_id AS cartItemId,cart_id,magic_bag_id,quantity,added_at,status 
FROM cart_items 
WHERE (cart_id = ? AND magicbag_id = ?)

é”™è¯¯ï¼šUnknown column 'magicbag_id' in 'where clause'
```

## æ ¹æœ¬åŸå› 
**åç«¯SQLè¯­å¥å­—æ®µåé”™è¯¯**

### é”™è¯¯SQL
```sql
WHERE cart_id = ? AND magicbag_id = ?  -- âŒ é”™è¯¯ï¼šå­—æ®µå magicbag_id
```

### æ­£ç¡®SQL
```sql
WHERE cart_id = ? AND magic_bag_id = ?  -- âœ… æ­£ç¡®ï¼šå­—æ®µå magic_bag_id (ä¸‹åˆ’çº¿)
```

## é—®é¢˜ä½ç½®
**æ–‡ä»¶**ï¼š`magic-bag-parent-main/magic-bag-cart/src/main/java/nus/iss/se/cart/mapper/CartItemMapper.java`

**éœ€è¦ä¿®æ”¹çš„SQLè¯­å¥**ï¼š
1. Line 18: `INSERT INTO cart_items (cart_id, magicbag_id, ...)` â†’ `magic_bag_id`
2. Line 26: `SELECT ... magicbag_id ...` â†’ `magic_bag_id`
3. Line 31: `@Result(property = "magicBagId", column = "magicbag_id")` â†’ `magic_bag_id`
4. Line 40: `WHERE cart_id = ? AND magicbag_id = ?` â†’ `magic_bag_id`
5. Line 68: `SELECT ... magicbag_id ...` â†’ `magic_bag_id`

## æ•°æ®åº“è¡¨ç»“æ„
```sql
CREATE TABLE cart_items (
    cart_item_id INT PRIMARY KEY,
    cart_id INT,
    magic_bag_id INT,  -- âœ… æ•°æ®åº“å­—æ®µåæ˜¯ magic_bag_id (ä¸‹åˆ’çº¿)
    quantity INT,
    added_at DATETIME,
    status VARCHAR(20)
);
```

## å·²å®Œæˆçš„ä¿®å¤
âœ… ä¿®å¤å·²æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼š
- æ–‡ä»¶ï¼š`magic-bag-parent-main/magic-bag-cart/src/main/java/nus/iss/se/cart/mapper/CartItemMapper.java`
- Commit: `5a3f51f Fix SQL column name: magicbag_id -> magic_bag_id`

## éœ€è¦çš„æ“ä½œ
1. æ‰‹åŠ¨æ¨é€ä¿®å¤åˆ°è¿œç¨‹ä»“åº“ï¼ˆæœ¬åœ°ä¿®å¤å·²å®Œæˆï¼‰
2. é‡æ–°éƒ¨ç½²CartæœåŠ¡
3. æµ‹è¯•Add to CartåŠŸèƒ½

## æµ‹è¯•æ­¥éª¤
ä¿®å¤åæµ‹è¯•ï¼š
```bash
POST http://13.215.158.65:10016/api/cart/15/items?magicbagId=102&quantity=1
Headers:
  Authorization: Bearer <valid_token>

Expected: 200 OK with cart data
Current: 400 Bad Request with SQL error
```

## ä¸ºä»€ä¹ˆå‰ç«¯æ— æ³•ä¿®å¤ï¼Ÿ
1. **å­—æ®µååœ¨SQLä¸­ç¡¬ç¼–ç **ï¼šé”™è¯¯å­—æ®µå `magicbag_id` å†™åœ¨åç«¯SQLè¯­å¥ä¸­
2. **å‰ç«¯ä¸ç”ŸæˆSQL**ï¼šå‰ç«¯åªå‘é€ `magicbagId=102`ï¼Œä¸æ¶‰åŠSQLå­—æ®µå
3. **åç«¯æ‰æ˜¯é—®é¢˜æºå¤´**ï¼šåªæœ‰ä¿®æ”¹åç«¯ä»£ç æ‰èƒ½ä¿®å¤

## å½±å“çš„API
- `POST /api/cart/{userId}/items` - æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
- `GET /api/cart/{userId}` - è·å–è´­ç‰©è½¦è¯¦æƒ…
- `PUT /api/cart/{userId}/items/{magicbagId}` - æ›´æ–°è´­ç‰©è½¦å•†å“æ•°é‡
- `DELETE /api/cart/{userId}/items/{magicbagId}` - åˆ é™¤è´­ç‰©è½¦å•†å“

## ç´§æ€¥ç¨‹åº¦
ğŸ”´ **é«˜ä¼˜å…ˆçº§** - å½±å“ç”¨æˆ·è´­ä¹°æµç¨‹çš„æ ¸å¿ƒåŠŸèƒ½

## è”ç³»æ–¹å¼
å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»å‰ç«¯å›¢é˜Ÿã€‚

